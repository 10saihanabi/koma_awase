<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>å°†æ£‹é–“é•ã„æ¢ã— - Fun Edition</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; text-align: center; background: #fdf6e3; margin: 0; padding: 20px; color: #5d4037; }
        #timer-container { position: fixed; top: 10px; left: 10px; background: #8d6e63; color: #fff; padding: 10px; border-radius: 5px; font-size: 18px; z-index: 100; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }
        
        /* ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç”¨ã®æ§ãˆã‚ãªã‚¹ã‚¿ã‚¤ãƒ« */
        .credit { font-size: 12px; color: #8d6e63; text-decoration: none; vertical-align: middle; margin-left: 5px; opacity: 0.7; }
        .credit:hover { opacity: 1; text-decoration: underline; }

        .board { display: grid; grid-template-columns: repeat(9, 45px); gap: 2px; justify-content: center; margin: 20px auto; width: fit-content; background: #dcb35c; padding: 10px; border: 4px solid #5d4037; border-radius: 8px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .cell { width: 45px; height: 45px; background: #fff; border: 1px solid #999; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; user-select: none; transition: background-color 0.2s; border-radius: 2px; }
        .gote { transform: rotate(180deg); }
        
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }
        .shaking { animation: shake 0.8s infinite; display: inline-block; }
        .gote.shaking { animation: shake 0.8s infinite; }

        #message { font-weight: bold; font-size: 18px; color: #a0522d; min-height: 2.5em; margin: 10px; }
        .btn { padding: 12px 24px; font-size: 16px; cursor: pointer; border-radius: 25px; border: none; margin: 8px; font-weight: bold; transition: transform 0.1s; }
        #startBtn { background: #ff9800; color: white; box-shadow: 0 4px #e68a00; }
        #hintBtn { background: #795548; color: white; display: none; }
        #xBtn { background: #000; color: white; text-decoration: none; display: none; align-items: center; justify-content: center; width: fit-content; margin: 15px auto; }
    </style>
</head>
<body>
    <div id="timer-container">â±ï¸ ã‚¿ã‚¤ãƒ : <span id="timer">0.00</span>ç§’</div>
    
    <h1>å°†æ£‹é–“é•ã„æ¢ã—<a href="https://x.com/hanabi7711" target="_blank" class="credit">by ã¯ãªã³</a> <span>ğŸš©</span></h1>
    
    <div id="stats">ã‚ã¨ <span id="remaining">5</span> å•ï¼</div>
    <div id="message"></div>
    <button id="hintBtn" class="btn" onclick="useHint()">ğŸ’¡ ãƒ’ãƒ³ãƒˆã‚’ã‚‚ã‚‰ã† (+10ç§’)</button>
    <div class="board" id="shogiBoard"></div>
    <button id="startBtn" class="btn" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚’ã¯ã˜ã‚ã‚‹ï¼</button>
    <a id="xBtn" class="btn" target="_blank">ğ• çµæœã‚’ã‚·ã‚§ã‚¢ã™ã‚‹</a>

    <script>
        const initialBoard = [
            ["é¦™","æ¡‚","éŠ€","é‡‘","ç‹","é‡‘","éŠ€","æ¡‚","é¦™"], ["","é£›","","","","","","è§’",""], ["æ­©","æ­©","æ­©","æ­©","æ­©","æ­©","æ­©","æ­©","æ­©"],
            ["","","","","","","","",""], ["","","","","","","","",""], ["","","","","","","","",""],
            ["æ­©","æ­©","æ­©","æ­©","æ­©","æ­©","æ­©","æ­©","æ­©"], ["","è§’","","","","","","é£›",""], ["é¦™","æ¡‚","éŠ€","é‡‘","ç‰","é‡‘","éŠ€","æ¡‚","é¦™"]
        ];
        let correctCount = 0, startTime, timerInterval, isGaming = false, mRow, mCol;

        function applyMistake(cell, piece) {
            const mistakeType = Math.random();
            if (mistakeType < 0.33) {
                const angles = ["90deg", "-90deg", "180deg"];
                const angle = angles[Math.floor(Math.random() * angles.length)];
                cell.style.transform = cell.classList.contains("gote") ? `rotate(${parseInt(angle)+180}deg)` : `rotate(${angle})`;
                return piece;
            } else if (mistakeType < 0.66) {
                const swapDict = { "é‡‘": "å…¨", "éŠ€": "é‡‘", "è§’": "é¦¬", "é£›": "é¾", "æ­©": "ã¨", "ç‹": "ç‰", "ç‰": "ç‹", "æ¡‚": "åœ­", "é¦™": "æ" };
                return swapDict[piece] || "é‡‘";
            } else {
                cell.classList.add("shaking");
                return piece;
            }
        }

        function startGame() {
            correctCount = 0; isGaming = true;
            document.getElementById("startBtn").style.display = "none";
            document.getElementById("xBtn").style.display = "none";
            document.getElementById("hintBtn").style.display = "inline-block";
            document.getElementById("message").innerText = "ãŠã‹ã—ãªé§’ã‚’ã•ãŒã›ï¼";
            startTime = Date.now();
            timerInterval = setInterval(() => { document.getElementById("timer").innerText = ((Date.now() - startTime) / 1000).toFixed(2); }, 10);
            nextQuestion();
        }

        function nextQuestion() {
            if (correctCount >= 5) { finishGame(); return; }
            document.getElementById("remaining").innerText = 5 - correctCount;
            const boardElement = document.getElementById("shogiBoard");
            boardElement.innerHTML = "";
            mRow = Math.floor(Math.random() * 9);
            mCol = Math.floor(Math.random() * 9);
            if (initialBoard[mRow][mCol] === "") { nextQuestion(); return; }

            for (let r = 0; r < 9; r++) {
                for (let c = 0; c < 9; c++) {
                    const cell = document.createElement("div");
                    cell.className = "cell";
                    if (r < 3) cell.classList.add("gote");
                    let piece = initialBoard[r][c];

                    if (r === mRow && c === mCol) {
                        piece = applyMistake(cell, piece);
                        cell.onclick = () => {
                            cell.style.backgroundColor = "#ffeb3b";
                            correctCount++; 
                            document.getElementById("message").innerText = "æŠ€ã‚ã‚Šï¼";
                            setTimeout(nextQuestion, 400);
                        };
                    } else {
                        cell.onclick = () => {
                            cell.style.backgroundColor = "#ffcdd2";
                            setTimeout(() => cell.style.backgroundColor = "#fff", 200);
                            document.getElementById("message").innerText = "ãã‚Œã¯ãµã¤ã†ã®é§’ã˜ã‚ƒ";
                        };
                    }
                    cell.innerText = piece;
                    boardElement.appendChild(cell);
                }
            }
        }

        function finishGame() {
            isGaming = false; clearInterval(timerInterval);
            const finalTime = document.getElementById("timer").innerText;
            const results = ["You win", "ãŠå‰ã®å‹ã¡ã˜ã‚ƒ", "ãŠå‰ã«ã¯æ¥½ã™ãã‚‹å•é¡Œã˜ã‚ƒã£ãŸãª"];
            const randomMsg = results[Math.floor(Math.random() * results.length)];
            
            document.getElementById("message").innerHTML = `ğŸŠ ${randomMsg}<br>ã‚¿ã‚¤ãƒ : ã€${finalTime}ç§’ã€‘`;
            document.getElementById("startBtn").style.display = "inline-block";
            document.getElementById("startBtn").innerText = "ã‚‚ã†ä¸€åº¦ã‚ãã¶";
            document.getElementById("hintBtn").style.display = "none";

            const xBtn = document.getElementById("xBtn");
            const tweetText = encodeURIComponent(`ã€å°†æ£‹é–“é•ã„æ¢ã—ã€‘\n${randomMsg}ï¼\n5ã¤ã®é–“é•ã„ã‚’ ${finalTime}ç§’ ã§è¦‹ã¤ã‘ãŸã âœ¨\n#å°†æ£‹é–“é•ã„æ¢ã— #é–“é•ã„æ¢ã— #è„³ãƒˆãƒ¬`);
            const tweetUrl = encodeURIComponent(window.location.href);
            xBtn.href = `https://twitter.com/intent/tweet?text=${tweetText}&url=${tweetUrl}`;
            xBtn.style.display = "flex";
        }

        function useHint() { startTime -= 10000; document.getElementById("message").innerText = `ãƒ’ãƒ³ãƒˆ: ${9-mCol}${"ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹"[mRow]} ã®ã‚ãŸã‚Šã‚’è¦‹ã‚ˆï¼`; }
    </script>
</body>
</html>
